## 应用层的基本任务

应用层主要负责不同主机多个应用进程之间的通信和协同工作，具体而言就是精确定义应用进程间的通信规则。应用层协议种类繁多，但基本都包含以下内容：

+ 应用进程交换的报文类型，如请求和响应报文；
+ 各类报文的语法，如各字段及其详细描述；
+ 字段的语义，即包含在字段中的信息的含义；
+ 进程何时、如何发送报文，以及对报文进行响应的规则。

许多应用层协议都是基于C/S方式运行的，即便是后面要提到的P2P通信。而值得注意的是，应用层协议仅仅是应用的组成部分之一（应用程序的开发就是另外一个话题了），并且也不是所有的应用程序都有联网通信的需求。此外，同一个应用程序可能还同时支持多个应用层协议，最典型的就是电子邮件，目前常见的电子邮件应用（比如Outlook、Thunderbird等）都支持SMTP、POP3以及IMAP等协议；反过来，即便是基于同一种应用层协议也能开发出各式各样的应用软件，典型例子就是市面上常见的各种浏览器，无论是Google Chrome还是FireFox，都必须使用到HTTP/HTTPS协议。

由于应用层协议种类繁多，而且新协议也是层出不穷，限于篇幅不可能一一介绍（有些协议还是非公开专用，甚至保密），下面主要介绍公开常用的几种重要协议。

## 域名系统DNS

### 何为域名

域名（domain name）是一台主机或路由器所使用的具有**层次树状结构**的名字，在整个互联网空间中具有唯一性，比如Google搜索使用的域名`www.google.com`。域名的“域”是名字空间中一个可被管理的划分，常见的域划分有顶级域、二级域和三级域等等。一个域名都是由标号（label）序列组成，各标号之间以`.`分隔。域名中的标号<font color=red>通常由英文字母、数字或连字符`-`</font>组成，每个标号不超过63个字符（在实际场景中建议不要超过12个），完整域名不超过255个字符，并且不区分大小写。代表<font color=blue>顶级域</font>的标号位于域名<font color=blue>最右边</font>，域层级从右往左依次下降。

互联网的域名空间是一棵根在上、枝叶在下的倒置树。根没有对应的名字，根以下第一层节点就被称作顶级域名（Top Level Domain，TLD），再往下就是二级、三级和四级等层级的域名，直到该域名已经能指示出单台主机为止便停止划分。目前顶级域名共分为以下三大类：

|类型|示例说明|
|:-----:|:---------:|
|国家顶级域名nTLD/ccTLD|us表示美国，cn表示中国等，允许使用域名所在国文字作为TLD|
|通用顶级域名gTLD|com表示公司企业，org表示非营利组织，gov表示政府部门等|
|基础结构域名|infrastructure domain只有arpa一个TLD，用于反向域名解析|

在nTLD下注册的二级域名均由该国家自行确定。

使用域名的好处在于使用方便，比如Bing搜索的其中一个服务器IP地址为`202.89.233.100`，然而用户不可能也不愿意去记Bing使用的所有服务器IP地址，因此使用`www.bing.com`这个域名去访问Bing无疑是比记一堆IP地址要方便得多。而域名与IP地址间的联系，会在DNS部分进行较为详细的介绍。

>注意，域名只是一个逻辑概念，不代表计算机所在的物理地点，其形式与IP地址的形式也<font color=red>没有必然关联</font>。

### DNS作用

DNS（Domain Name System）是互联网使用的一套命名系统，依据标准为RFC 1034/1035，用来把计算机域名解析为IP地址。

DNS被设计为一个联机分布式数据库系统，并采用C/S方式，使得大多数名字都可以在本地进行解析，仅少量解析需要在互联网上通信，因此效率很高。域名到IP地址的解析，是由分布在互联网上许多运行有专门解析程序的域名服务器共同完成的，其主要过程为：当某一应用进程需要把域名解析为IP地址时，就调用解析程序，并成为DNS的一个client，把待解析的域名放在DNS请求报文中，通过<font color=red>UDP</font>发给**本地**域名服务器。本地域名服务器在查找到域名对应的IP地址后（若本地查找不到就向其他域名服务器发起请求扩大查找范围），就返回一个携带该IP地址的应答报文，应用进程拿到应答报文后就可以取出IP地址进行通信。

### 域名服务器

DNS采用划分区（zone）的方式来解决域名服务器数量过多降低运行效率的问题。所谓的区，是指一个域名服务器所负责管辖的（或有权限的）范围，从关系上来讲，“区”是“域”的**子集**。为了提高DNS查询效率，除了划分区以外，域名服务器还广泛使用高速缓存，用于存放最近的查询结果。根据域名服务器所起的作用，可以划分出四种不同类型：

1. **根域名服务器（root name server）**

根域名服务器是<font color=red>最高层次</font>，也是最重要的域名服务器。所有的根域名服务器都知道所有顶级域名服务器的域名和IP地址，如果根域名服务器全部瘫痪，那么整个互联网的DNS系统都将无法工作。鉴于根域名服务器的特殊地位，建立一个根域名服务器有许多具体要求（尤其是防御网络攻击方面），并不是随便租用一台服务器主机就能建起来，可以参阅RFC 2870。

全球各地都安装有根域名服务器，但它们只使用<font color=red>13个</font>不同IP地址的**域名**（从a.root-servers.net到m.root-servers.net），简而言之，绝大多数根域名服务器只是起到镜像同步的作用，因此确切来说全世界目前有<font color=red>13组</font>根域名服务器，分别用A到M来表示。各组根域名服务器的镜像数量和覆盖范围都各不相同。再次强调，目前全世界共有13个根域名（包括1个主根域名和12个辅根域名）和对应的13组根域名服务器，而不是某些垃圾博客和劣质科普文章所说的13台根域名服务器，仅仅依靠13台服务器根本不可能支撑起全球互联网服务。

由于根域名服务器采用了任播（anycast）技术，因此当DNS客户向某个根域名服务器的IP地址发出查询报文时，互联网上的路由器就能找到离该客户最近的一个根域名服务器，加快查询速度，使互联网资源利用更为合理。根域名服务器并不存放顶级域名服务器以下级别的域名和对应IP地址信息，因此在许多情况下只是告诉本地域名服务器下一步应当通过哪个顶级域名服务器进行查询。

2. **顶级域名服务器**

顶级域名服务器负责管理在该顶级域名服务器所注册的所有二级域名，当收到DNS查询请求时，就给出相应的回答，可能是最终结果，也有可能是下一步应当查找的域名服务器的IP地址。

3. **权限域名服务器**

权限域名服务器就是负责一个区的域名服务器。

4. **本地域名服务器（local name server）**

本地域名服务器也称默认域名服务器，是主机发出DNS查询请求获取目标域名对应IP地址的第一站（通常也是最后一站）。本地域名服务器的建立要求相对要低一些，即便是一个普通单位也可以拥有。用户在计算机上配置网络时可能会被要求设置DNS服务器，指的就是设置本地服务器。由于本地域名服务器通常距离主机较近，一般不超过几个路由器，因此查询速度非常快。

主机向本地域名服务器查询一般采用**递归**查询（recursive query），即本地域名服务器自己没有相应结果的情况下，就会<font color=red>代替主机</font>向根域名服务器继续进行查询，根域名服务器将查询委托给顶级域名服务器，顶级域名服务器再将查询委托给权限域名服务器，然后将查询结果或报错信息按原路返回给主机。

本地域名服务器向根域名服务器查询一般用**迭代**查询（iterative query），当然也可以用递归查询，这取决于查询请求报文的设置。迭代查询是指本地域名服务器在查询过程中，没有上级域名服务器层层委托转交查询请求和回答结果，而是直接让本地服务器向对应上级域名服务器查询。

两者的差别可以通过下图看出：

![](pics/dns.png)

可以看到，不管采用什么类型的查询方式，主机始终只要跟本地域名服务器打交道，这样就减少了主机的工作负担。

## 文件共享协议FTP/TFTP

文件共享协议可以分为两大类，一类是复制整个文件到本地，其含义为：若要存取一个文件，就必须先获得一个本地的文件副本。如果要修改文件，只能对文件的副本进行修改，然后再将修改后的文件副本传回原节点。像FTP和TFTP就是属于这种类型。但是<font color=red>每次都要传输一整个文件副本的做法并不总是合理的</font>，因此出现了另一类文件共享协议。

文件共享协议的另一大类是联机访问（on-line access），即允许多个程序同时对一个文件进行存取，但用户不需要使用特殊的客户进程，而是由**操作系统**提供对远地共享文件进行访问的服务，如同对本地文件的访问一样，实现了**透明存取**。常用的协议有NFS（Network File System），主要用在TCP/IP网络上，适用于UNIX和MS-Windows等系统。NFS允许应用进程打开一个远程文件，并能在该文件的某一特定位置上读写数据，用户只需要复制文件中一个很小的片段，然后通过网络传输少量修改数据即可。

### 文件传送协议FTP

FTP（File Transfer Protocol）是互联网上使用最为广泛的文件传送协议，它基于TCP，采用C/S方式运行，提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。FTP的主要功能是减少或消除在不同操作系统下处理文件的不兼容性。

FTP的应用进程分为server和client。server可同时为多个client提供服务，并且由两部分组成：负责接收新请求的主进程，以及若干负责处理单个请求的从属进程。主进程的工作步骤为：

1. 打开端口21，使client进程能够连接上；
2. 等待client进程发出连接请求；
3. 启动从属进程处理client进程发来的请求，处理完毕即终止，可根据需要创建其他子进程；
4. 回到等待状态，继续接受其他client进程发来的请求。

>注意，主进程和从属进程的处理是并发进行的。

在进行文件传输时，FTP的client和server之间要建立两个并行的TCP连接，即用来传输传送请求的**控制连接**，以及用来传输文件数据的**数据连接**。前者在整个会话期间一直保持打开，与文件传输相分离，因此FTP的控制信息传输也被称作带外（out of band）传送。

### 简单文件传送协议TFTP

TFTP（Trivial File Transfer Protocol）是一个基于UDP的文件分享协议，它只支持文件传输而不支持交互，也不能对用户进行身份鉴别，主要在小型设备上。TFTP的主要特点有：

1. 除最后一次传送外，每次传送的数据报文中必须有512字节的数据；
2. 数据报文从1开始按序编号；
3. 支持ASCII码或二进制传送；
4. 可对文件进行读写；
5. 使用很简单的首部。

TFTP在工作时，client会向server的69端口发送请求报文，server选择一个新的端口和client进行通信。每发送完一个文件块后就等待对方的确认，确认时应指明所确认的块编号，规定时间内未收到确认就重发数据。

## 超文本传送协议HTTP

HTTP（HyperText Transfer Protocol）是万维网（World Wide Web，WWW，也称Web）的核心组成部分，它定义了浏览器如何向服务器请求文档，以及服务器如何将文档传送给浏览器，基于TCP运行。为了提高安全性，HTTP现在又加上SSL/TLS协议对传输的数据实施加密，形成了HTTPS（HTTP over Secure Socket Layer）。

>SSL是Secure Socket Layer的缩写，TLS是Transport Layer Security的缩写，后者由前者发展而来。

### Web、URL与HTML

Web是一个大规模联机式的信息存储系统，由大量站点提供分布式的超媒体（hypermedia）系统服务。超媒体是超文本的扩充，所谓超文本是指包含指向其他文档的链接的文本，仅包含文本信息，而超媒体还包括图形音像等非文本类信息。Web把大量信息分布在整个互联网上，每个站点单独管理自己的文档——也就是页面（page）——并通过链接进行访问。可以说，Web就是互联网的基石，没有Web也就不会有今天的互联网，更不会有后来以智能移动设备和App为核心的移动互联网（现在基于浏览器提供网页服务的被称作WebApp）。

之前提到，互联网各个站点通过链接（link）建立联系，所谓链接，实际上指代的是统一资源定位符URL（Uniform Resource Locator），一个在整个互联网范围内的唯一标识符。能够在互联网上可以被访问到的任何类型的对象都被称为“资源”，使用URL就可以标识这些资源在互联网上的位置以及访问方法。URL的基本格式为：`<协议>://<域名/IP地址>:<端口>/<路径>`， 目前常用的协议有HTTP和FTP。使用HTTP协议的URL可以省略端口，因为HTTP使用的是[系统端口](/ComputerNetwork/Chapter_5_运输层?id=基本概念)80。如果把路径省略，那么就默认访问的是一个站点的主页（home page）。主页是一个站点最高级别的页面，主要用来展示站点的重要信息，同时也可以提供访问其他页面或站点的链接。

HTML（HyperText Markup Language，超文本标记语言）是Web使用的一种核心技术，用于制作Web页面，截至2021年8月，最新版本为HTML 5.0。HTML文档跟普通文档的主要区别在于标签（tag）的使用，如果把`.html`文件直接改成`.txt`，原有的文本基本上都能直接读取出来，而且用于设置文本样式和资源链接的各类标签也会直接展示。HTML的标准由W3C负责制定维护，详见地址：[https://html.spec.whatwg.org/multipage/sections.html](https://html.spec.whatwg.org/multipage/sections.html)。HTML并不总是单独出现，与之配套使用的还有CSS（Cascading Style Sheets，层叠样式表），专门用于为HTML文档定义布局，比如在浏览器上显示的字体、颜色、边距、高度、宽度、背景以及图像等。HTML和CSS的主要区别是前者用于结构化内容，而后者用于格式化这些内容。

早期的Web站点都是基于HTML开发一系列静态文档（static document）进行展示，随着技术的发展又出现了由应用程序动态创建的动态文档（dynamic document），当服务器接收到浏览器请求时就运行CGI程序生成HTML文件并返回给浏览器进行展示。CGI（Common Gateway Interface，通用网关接口）是一种标准，它定义了动态文档如何被创建，输入的数据如何提供给应用程序，以及输出结果应如何使用。

为了使HTML能进一步支持活动内容（比如动画效果），又出现了一种称作“活动文档”（active document）的技术。活动文档中嵌入了Java applet（小程序），当浏览器下载该类型文档之后，用户点击页面上的区域或控件，就可以动态地改变页面上展示的内容。活动文档跟动态文档的差别在于，前者的活动内容展示需要由浏览器支持并执行，而后者需要服务器运行CGI程序。

### HTTP工作原理

HTTP是一种**面向事务**（transaction-oriented）的应用层协议，除了传送完成链接跳转所必需的信息，还传送任何可从互联网上得到的信息。基于HTTP的Web工作过程大致如下图所示：

![](pics/http.png)

HTTP基于TCP实现可靠传输，不需要考虑数据在传输过程中被丢弃后又怎样被重传。HTTP本身是<font color=red>无连接</font>的，即通信双方在交换HTTP报文之前不必先建立所谓的HTTP连接；HTTP也是<font color=red>无状态</font>（stateless）的，服务器并不知道客户是否访问过，也不知道为该客户提供过多少次服务——当然，这是在不使用Cookie等手段记录访客信息的情况下——从这一角度来看，无状态的特性可以简化服务器的设计。

HTTP目前已经更新到2.0版本，但主要在用的版本依然是HTTP/1.0和HTTP/1.1。HTTP/1.0有一个明显的缺点是采用**非持续连接**，每请求一个文档就得建立一个TCP连接，并且还要发送请求和接收文档，之后断开，这样就花费了两倍的RTT；而每次建立连接都要分配服务器资源，通信量也会随之上升，对服务端的工作负担很大。HTTP/1.1对此进行了改进，采取**持续连接**（persistent connection）方式确保只用一条TCP连接就可以传送HTTP请求报文和响应报文，减少了通信量和服务器工作负担。此外，HTTP/1.1还支持非流水线（without pipeline）和流水线（with pipeline）两种工作方式，目前普遍使用的是后一种类型。

#### HTTP报文结构

HTTP报文分为请求报文和响应报文两大类。由于HTTP是面向文本的，因此报文中的每个字段都是一些ASCII码串，各个字段长度并不固定。先来看请求报文的基本格式：

```
方法 相对URL 版本   <这是请求行>
首部字段名1: 值1    <这是首部行的第一个字段>
首部字段名2: 值2
···
                   <首部行与报文主体间必须用一行CRLF分隔>
报文主体            <报文主体可以为空>
```

请求方法和含义可以参考Mozilla的相关文档：[https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)

响应报文的格式除了最开始一行，几乎与请求报文没有差别：

```
版本 状态码 状态短语    <这是响应行>
首部字段名1: 值1        <这是首部行第一个字段>
首部字段名2: 值2
···
                       <首部行与报文主体间必须用一行CRLF分隔>
报文主体                <报文主体可为空>
```

状态码和含义可以参考Mozilla相关文档：[https://developer.mozilla.org/en-US/docs/Web/HTTP/Status](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)。

利用Google Chrome的开发者工具（按F12调出），在Network选项下选择一个会话，即可查看该会话的请求和响应报文详细信息，如下图所示：

![](pics/http2.png)

#### 代理服务器

代理服务器（proxy server）是一种网络实体，负责把最近的一些请求和响应暂存在本地磁盘中，当新请求到达时，若代理服务器发现这个请求已经存在，就直接返回暂存的响应，否则就进入互联网访问该资源。使用代理服务器的好处是可以提高资源的访问速度，减少通信链路的负担，而坏处就是如果代理服务器的缓存更新不及时，那么用户的使用体验会非常糟糕，典型的反面教材就是长城宽带的缓存服务器。

#### Cookie

Cookie是一种在HTTP服务器和客户之间传递的状态信息，目前尚无标准译名。由于HTTP本身是无状态的，因此在某些需要保存状态的场景中，比如在线购物，就必须设法保存用户的状态信息，目前通用的方案就是使用Cookie。

当用户浏览某个使用Cookie的网站时，该站服务器就为用户生成并在响应报文中返回一个Cookie值（赋给首部行字段Set-cookie），同时在数据库中保存；用户浏览器收到该响应后，就会在特定Cookie文件中加入该Cookie值和对应的主机名，用户继续浏览该网站时，每发送一个请求报文，都会用这个Cookie值去设置首部行字段Cookie，这样该网站的服务器就能跟踪用户在该站的活动。但是Cookie的使用也带来了用户隐私泄露的隐患，因此市面上的浏览器也都基本支持禁用Cookie。

## 电子邮件协议SMTP/POP3/IMAP

电子邮件协议分为邮件发送和邮件读取两大类，前者使用简单邮件传送协议SMTP（Simple Mail Transfer Protocol），后者使用邮局协议版本3POP3（Post Office Protocol ver.3），以及网际报文存取协议IMAP（Internet Message Access Protocol）。

### SMTP工作原理

SMTP规定了在两个相互通信的SMTP进程之间应如何交换信息。SMTP采用C/S方式，但并未规定邮件内部格式、如何存储以及邮件系统的发送速度等详细内容。SMTP规定了14条命令和21种应答信息，每条命令用几个字母组成，而每一种应答信息一般只有一行信息，由一个3位数字的代码开始，后面可能会附上简单的文字说明。

SMTP不使用中间的邮件服务器，而是直接在通信双方之间建立TCP连接。发件人的邮件送到发送方邮件服务器的邮件缓存后，SMTP客户每隔一段时间对邮件缓存扫描一次，若发现有邮件，就通过端口25通接收方的SMTP服务器建立连接。连接建立后，接收方SMTP服务器发出“220 Service ready”，SMTP客户向服务器发送HELO命令，并附上发送方的主机名。若服务器有能力接收邮件，就回答"250 OK"，否则就返回“421 Service not available”，发送方需要等待一段时间后在尝试建立连接发送邮件。

邮件传送时，SMTP客户先发送MAIL命令，确认服务器已准备好接收邮件，然后通过RCPT命令确认接收方邮箱地址是否正确，最后调用DATA命令正式传送邮件内容。邮件发送完成之后，SMTP客户发出QUIT命令，服务器返回“221”信息同意释放连接，邮件的传送过程就结束了。尽管发送成功不代表收件人必然能读取邮件，但是基于SMTP的电子邮件通常都被认为在“确保邮件能被对方收到”这件事情上是可靠的。

2008年10月颁布的RFC 5321对SMTP进行扩充，形成了ESMTP（Extended SMTP），用来解决发送邮件不鉴权带来的垃圾邮件问题、非ASCII码长报文传输效率低下问题以及明文传输引发的安全性问题。为了兼容原有的SMTP邮件服务器，ESMTP客户端在准备传送报文时会先发送EHLO报文判断服务器是否使用ESMTP，若报文被拒绝，就采用SMTP参数进行邮件传送，否则使用ESMTP参数。

### POP3工作原理

POP3是一个非常简单，但是功能有限的邮件读取协议，也是采用C/S方式运行。POP3服务器只有在用户输入鉴别信息后才允许读取，而且读取完邮件之后就会将该邮件删除，当然后来POP3做了改进，允许用户事先设置邮件读取后仍能继续在POP3服务器保存的时间。

### IMAP工作原理

IMAP是一个联机协议，跟POP3一样采用C/S方式运行，目前最新版本为IMAP4。用户通过IMAP客户端与接收方的IMAP服务器建立TCP连接，在自己的计算机上就可以操纵邮件服务器的邮箱。和POP3不同，读取邮件的操作并不会删除服务器上的内容，只有用户明确执行了删除操作，服务器才会删除邮件。IMAP的好处在于用户可以在不同地方使用不同的计算机随时处理邮件，而且可以只阅读一部分邮件内容，包含较大体积附件的邮件不必在阅读前完全下载所有数据。IMAP需要用户联网才能从邮件服务器复制邮件到自己的计算机上，因此使用IMAP客户端时要保证网络正常。

IMAP和POP3的主要功能对照如下：

|操作位置|操作内容|IMAP|POP3|
|:-----:|:---------------:|:----------:|:----------:|
|收件箱|阅读、标记、移动、删除邮件等|客户端与邮箱同步更新|仅在客户端内|
|发件箱|保存到已发送|同上|同上|
|创建文件夹|创建自定义的文件夹|同上|同上|
|草稿|保存草稿|同上|同上|
|垃圾文件夹|接收并移入垃圾文件夹的邮件|支持|不支持|
|广告邮件|接收并移入广告文件夹的邮件|支持|不支持|

### 通用互联网邮件扩充MIME

MIME（Multipurpose Internet Mail Extensions）是针对SMTP存在的若干缺点而提出的一种解决方案，在不改动邮件格式的基础上，增加了邮件主体的结构，并定义了传送非ASCII码的编码规则。

>SMTP存在的缺点有：
>(1)不能传送可执行文件或其他二进制对象；
>(2)仅限传送7位的ASCII码，非ASCII码字符无法传送；
>(3)SMTP会拒绝超过一定长度的邮件；
>(4)某些SMTP的实现没有完全按照互联网标准。

MIME主要包含三部分内容：5个邮件首部新字段、邮件内容格式定义和传送编码定义。


1. **邮件首部字段**

MIME的5个邮件首部字段及其含义如下表所示：

|字段|含义说明|
|MIME-Version|标识MIME的版本，当前版本为1.0。若无此行则为英文文本|
|Content-Description|标识邮件主体类型是否为图像、音频或视频|
|Content-Id|邮件唯一标识符|
|Content-Transfer-Encoding|标识传送邮件主体时采取何种编码方案|
|Content-Type|说明邮件主体的数据类型和子类型|

2. **邮件内容格式**

邮件内容格式由Content-Type字段定义。Content-Type由两个标识符组成，其形式为`内容类型/子类型`。下表是可在MIME中出现的内容类型和子类型举例：

|内容类型|子类型举例|说明|
|:-----:|:----------:|:----------:|
|text（文本）|plain，html，xml，css等|不同格式的文本|
|image（图像）|gif，jpeg，tiff等|不同格式的图像|
|audio（音频）|basic，mpeg，mp3等|不同格式的音频|
|video（视频）|mpeg，mp4，quicktime等|不同格式的影片|
|model（模型）|vrml|3D模型|
|application（应用）|pdf，javascript，zip等|不同应用程序产生的数据|
|message（报文）|http，rfc822等|不同协议的封装报文|
|multipart（多部分）|mixed，alternative，parallel，digest|多种类型的组合|

multipart类型是一个值得关注和利用的类型，因为它使邮件增加了相当大的灵活性。其子类型和含义如下：

|子类型字段|含义说明|
|:-----|:---------|
|mixed|允许单个报文含有多个相互独立的子报文，每个报文可有自己的类型和编码。mixed后面需要使用`Boundary=`来定义一个分隔字符串（邮件内容中不能存在相同的字符串），各报文之间以`--分隔字符串`作为区分标志，而multipart整体以`--分隔字符串--`作为结束标志。|
|alternative|允许单个报文含有同一数据的多种表示|
|parallel|允许单个报文含有可同时显示的各个字部分|
|digest|允许单个报文含有一组其他报文|

3. **内容传送编码**

由ASCII码字符构成，且每行不超过1000字符的邮件主体不需要再进行编码转换即可直接传送。

包含**少量**非ASCII码字符的邮件主体，对除特殊字符`=`以外的可打印ASCII码都不转换，`=`和所有非ASCII字符都要先将每个字节的二进制代码用十六进制数表示，然后在前面加上等号`=`。这种编码方式被称作quoted-printable。

对于任意的二进制文件，可以使用base64编码，即先把二进制代码按照24位一组划分成若干个单元，然后每个单元划分为4个6位组。6位二进制代码可以表示64种值，从0到63可以依次表示26个大写字母、26个小写字母、0-9共计10个数字以及表示62的`+`和63的`/`。最后再用`==`和`=`分别表示最后一个单元仅有8位和16位。base64编码忽略回车和换行。

## 动态主机配置协议DHCP

DHCP（Dynamic HostConfiguration Protocol）是一种实现即插即用联网机制的应用层协议，采用C/S方式，基于UDP运行。无论一台主机是固定的还是移动的，运行的是client还是server程序，DHCP都适用。DHCP客户在通信过程中使用端口68，而DHCP服务器使用端口67。

DHCP的工作过程为：需要配置IP地址的主机启动时，向DHCP服务器广播发送发现报文（DHCPDISCOVERY），报文中的源地址被设为`0.0.0.0`，目的地址被设为`255.255.255.255`，这时主机就成为了DHCP客户。DHCP服务器接收到该报文后，会先在自己的数据库中查找该主机的配置信息，如果有就返回找到的信息，否则就从IP地址池（address pool）里分配一个地址，并通过提供报文（DHCPOFFER）将IP地址的配置信息返回给该主机。对于运行服务器程序而位置固定的主机，DHCP会为其指派一个永久地址。整个过程不需要手工干预，完全自动配置。在常用的操作系统中，如果网络配置选用自动获得IP地址和DNS地址，那么就表明在使用DHCP。

在实际使用中，并不是每个网络都会设置有DHCP服务器，否则的话数量就太多了，成本也会很高。通常的做法是在一个网络中用一台路由器充当**DHCP中继代理**（relay agent），它被配置了DHCP服务器的IP地址信息，需要设置IP地址的主机的广播报文被中继代理收到后，就会向真正的DHCP服务器单播转发此报文，待DHCP服务器回答后再将提供报文转发回该主机。

值得注意的是，DHCP分配给DHCP客户的IP地址是有时限的，这个时限称为“租用期”（lease period），短至1秒，长至136年不等，可以由DHCP服务器单方面设置，也可以由DHCP客户向DHCP服务器提出要求。

## 简单网络管理协议SNMP

SNMP（Simple Network Management Protocol）是一套用于实施网络管理的庞大标准体系（一共有RFC 3411~3418共计8个文档进行描述），目前较新的版本是SNMPv3。

所谓网络管理，简称网管，目前还没有精确定义，其核心内容主要包括**对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、测试、配置、分析、评价和控制，从而以合理成本满足网络的一些需求，如实时运行性能、服务质量等**。

## P2P通信

### 具有集中目录服务器的工作方式

### 具有全分布式结构的工作方式